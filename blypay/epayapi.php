<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"> <html> <head> <meta http-equiv="Content-Type" content="text/html; charset=utf-8"> <title>BL云支付</title> </head> <?php require_once("epay.config.php"); require_once("lib/epay_submit.class.php"); require_once $_SERVER['DOCUMENT_ROOT'] . '/include/conn.php';  session_start(); $h_userName=""; if(isset($_COOKIE['m_username'])&&$_COOKIE['m_username']!=""){ $h_userName=$_COOKIE['m_username']; }else{ echo '<script>location.href="/member/login.php";</script>'; exit(); }  $notify_url = $gourl."/blypay/notify_url.php"; $return_url = $gourl."/blypay/return_url.php"; $out_trade_no =$_REQUEST['out_trade_no'];$type = $_REQUEST['payType']; $name =$out_trade_no; $money = $_REQUEST['skl_custom_money']; $sitename =$out_trade_no; $parameter = array( "pid" => trim($alipay_config['partner']), "type" => $type, "notify_url"	=> $notify_url, "return_url"	=> $return_url, "out_trade_no"	=> $out_trade_no, "name"	=> $name, "money"	=> $money, "sitename"	=> $sitename ); $h_money=number_format($money,2,".",""); $orderid=$out_trade_no; $bank="1"; if($type=="wxpay"){ $bank="1"; }else if($type=="alipay"){ $bank="2"; }else if($type=="qqpay"){ $bank="3"; } $sql="insert into blypay_order (orderid,`amout`,addtime,`state`,`bank`,`username`) values ('".$orderid."','".$h_money."','".date("Y-m-d H:i:s")."','0','".$bank."','".$h_userName."')"; $result = $db->query($sql); if(!$result){ exit("参数有误"); } $alipaySubmit = new AlipaySubmit($alipay_config); $html_text = $alipaySubmit->buildRequestForm($parameter); echo $html_text; ?> </body> </html>